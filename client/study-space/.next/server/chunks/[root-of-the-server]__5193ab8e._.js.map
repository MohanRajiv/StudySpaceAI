{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Downloads/study-space-ai/client/study-space/database.js"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nif (!MONGODB_URI) throw new Error(\"Missing MONGODB_URI\");\n\nlet cached = global.mongoose;\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null };\n}\n\nexport async function connectToDB() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    cached.promise = mongoose.connect(MONGODB_URI, {\n      dbName: \"clerkauthv5\",\n      bufferCommands: false,\n    });\n  }\n  cached.conn = await cached.promise;\n  console.log(\"Connected to MongoDB\");\n  return cached.conn;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;AAElC,IAAI,SAAS,yDAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;YAC7C,QAAQ;YACR,gBAAgB;QAClB;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,QAAQ,GAAG,CAAC;IACZ,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Downloads/study-space-ai/client/study-space/modals/user.modal.js"],"sourcesContent":["import { Schema, model, models } from \"mongoose\";\n\nconst userSchema = new Schema({\n  clerkId: { type: String, required: true, unique: true },\n  email: { type: String, required: true },\n  googleDriveTokens: {\n    accessToken: String,\n    refreshToken: String,\n    expiryDate: Date,\n  },\n});\n\nconst User = models.User || model(\"User\", userSchema);\n\nexport default User;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,mHAAM,CAAC;IAC5B,SAAS;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACtD,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,mBAAmB;QACjB,aAAa;QACb,cAAc;QACd,YAAY;IACd;AACF;AAEA,MAAM,OAAO,mHAAM,CAAC,IAAI,IAAI,IAAA,kHAAK,EAAC,QAAQ;uCAE3B","debugId":null}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Downloads/study-space-ai/client/study-space/app/api/google-drive/callback/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { auth } from \"@clerk/nextjs/server\";\nimport { google } from \"googleapis\";\nimport { connectToDB } from \"@/database\";\nimport User from \"@/modals/user.modal\";\n\nfunction getOAuth2Client() {\n  const clientId = process.env.GOOGLE_CLIENT_ID;\n  const clientSecret = process.env.GOOGLE_CLIENT_SECRET;\n  const redirectUri = process.env.GOOGLE_REDIRECT_URI;\n\n  if (!clientId || !clientSecret || !redirectUri) {\n    throw new Error(\"Google OAuth environment variables not configured\");\n  }\n\n  return new google.auth.OAuth2(clientId, clientSecret, redirectUri);\n}\n\nexport async function GET(req) {\n  try {\n    const { userId } = await auth();\n    if (!userId) {\n      return NextResponse.redirect(new URL(\"/create?error=unauthorized\", req.url));\n    }\n\n    const { searchParams } = new URL(req.url);\n    const code = searchParams.get(\"code\");\n    const state = searchParams.get(\"state\");\n\n    if (!code) {\n      return NextResponse.redirect(new URL(\"/create?error=no_code\", req.url));\n    }\n\n    // Verify state matches userId\n    if (state !== userId) {\n      return NextResponse.redirect(new URL(\"/create?error=invalid_state\", req.url));\n    }\n\n    // Initialize OAuth2Client\n    const oauth2Client = getOAuth2Client();\n\n    // Exchange code for tokens\n    const { tokens } = await oauth2Client.getToken(code);\n    oauth2Client.setCredentials(tokens);\n\n    // Store tokens in database\n    await connectToDB();\n    const user = await User.findOne({ clerkId: userId });\n\n    if (!user) {\n      return NextResponse.redirect(new URL(\"/create?error=user_not_found\", req.url));\n    }\n\n    user.googleDriveTokens = {\n      accessToken: tokens.access_token,\n      refreshToken: tokens.refresh_token,\n      expiryDate: tokens.expiry_date ? new Date(tokens.expiry_date) : null,\n    };\n\n    await user.save();\n\n    return NextResponse.redirect(new URL(\"/create?google_drive=connected\", req.url));\n  } catch (error) {\n    console.error(\"Error in OAuth callback:\", error);\n    return NextResponse.redirect(new URL(\"/create?error=callback_failed\", req.url));\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,SAAS;IACP,MAAM,WAAW,QAAQ,GAAG,CAAC,gBAAgB;IAC7C,MAAM,eAAe,QAAQ,GAAG,CAAC,oBAAoB;IACrD,MAAM,cAAc,QAAQ,GAAG,CAAC,mBAAmB;IAEnD,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,aAAa;QAC9C,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,+JAAM,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,cAAc;AACxD;AAEO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,6LAAI;QAC7B,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,8BAA8B,IAAI,GAAG;QAC5E;QAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,IAAI,GAAG;QACvE;QAEA,8BAA8B;QAC9B,IAAI,UAAU,QAAQ;YACpB,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,+BAA+B,IAAI,GAAG;QAC7E;QAEA,0BAA0B;QAC1B,MAAM,eAAe;QAErB,2BAA2B;QAC3B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,aAAa,QAAQ,CAAC;QAC/C,aAAa,cAAc,CAAC;QAE5B,2BAA2B;QAC3B,MAAM,IAAA,yHAAW;QACjB,MAAM,OAAO,MAAM,oIAAI,CAAC,OAAO,CAAC;YAAE,SAAS;QAAO;QAElD,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gCAAgC,IAAI,GAAG;QAC9E;QAEA,KAAK,iBAAiB,GAAG;YACvB,aAAa,OAAO,YAAY;YAChC,cAAc,OAAO,aAAa;YAClC,YAAY,OAAO,WAAW,GAAG,IAAI,KAAK,OAAO,WAAW,IAAI;QAClE;QAEA,MAAM,KAAK,IAAI;QAEf,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,kCAAkC,IAAI,GAAG;IAChF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iCAAiC,IAAI,GAAG;IAC/E;AACF","debugId":null}}]
}