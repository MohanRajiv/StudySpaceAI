{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Downloads/study-space-ai/client/study-space/app/quizPage/page.js"],"sourcesContent":["\"use client\";\nimport { useSearchParams } from \"next/navigation\";\nimport { useState, useEffect, useRef } from \"react\";\n\nexport default function QuizPage() {\n  const searchParams = useSearchParams();\n  const quiz_id = searchParams.get(\"quiz_id\");\n  const [quiz, setQuiz] = useState(null);\n  const [answers, setAnswers] = useState({}); \n  const [submitted, setSubmitted] = useState(false);\n  const [scoreCount, setScoreCount] = useState(0);\n  const [totalSeconds, setTotalSeconds] = useState(0);\n  const [timerExpired, setTimerExpired] = useState(false);\n  const timerId = useRef(null);\n  const [hideTimer, setHideTimer] = useState(false);\n\n  useEffect(() => {\n    if (!quiz_id) return;\n\n    const fetchQuiz = async () => {\n      try {\n        const res = await fetch(`/api/get-quiz?id=${quiz_id}`);\n        const data = await res.json();\n        setQuiz(data);\n\n        if (data.timerSeconds > 0) {\n          setTotalSeconds(data.timerSeconds);\n        }\n        else {\n          setHideTimer(true);\n        }\n\n      } catch (err) {\n        console.error(\"Error fetching quiz:\", err);\n      }\n    };\n\n    fetchQuiz();\n  }, [quiz_id]);\n\n  useEffect(() => {\n    if (totalSeconds <= 0 || submitted) {\n      clearInterval(timerId.current);\n      return;\n    }\n  \n    timerId.current = setInterval(() => {\n      setTotalSeconds(prev => {\n        if (prev <= 1) {\n          clearInterval(timerId.current);\n          setTimerExpired(true);\n          handleSubmit(true); \n          return 0;\n        }        \n        return prev - 1;\n      });\n    }, 1000);\n  \n    return () => clearInterval(timerId.current);\n  }, [totalSeconds, submitted]);\n\n  const handleSingleSelect = (questionIndex, optionIndex) => {\n    if (submitted) return;\n    setAnswers((prev) => ({\n      ...prev,\n      [questionIndex]: [optionIndex] \n    }));\n  };\n\n  const handleMultipleToggle = (questionIndex, optionIndex) => {\n    if (submitted) return;\n\n    setAnswers((prev) => {\n      const current = prev[questionIndex] || [];\n      return current.includes(optionIndex)\n        ? { ...prev, [questionIndex]: current.filter((x) => x !== optionIndex) }\n        : { ...prev, [questionIndex]: [...current, optionIndex] };\n    });\n  };\n\n  const startTimer = () => {\n    if (timerId.current) return;\n  \n    const total = buildTotalSeconds();\n    if (total <= 0) return;\n  \n    setHideInput(true);\n    setTimerExpired(false);\n    setTotalSeconds(total);\n  \n    timerId.current = setInterval(() => {\n      setTotalSeconds(prev => {\n        if (prev <= 1) {\n          clearInterval(timerId.current);\n          timerId.current = null;\n          setTimerExpired(true);\n          setHideInput(false);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n  };\n  \n  const stopTimer = () => {\n    clearInterval(timerId.current);\n    timerId.current = null;\n  };\n  \n  const resetTimer = () => {\n    stopTimer();\n    setTimerExpired(false);\n    setHideInput(false);\n    setTotalSeconds(0);\n    setHours(0);\n    setMinutes(0);\n    setSeconds(0);\n  };\n\n  const formatTime = (secs) => {\n    const h = Math.floor(secs / 3600);\n    const m = Math.floor((secs % 3600) / 60);\n    const s = secs % 60;\n  \n    return `${String(h).padStart(2, \"0\")}:${String(m).padStart(2, \"0\")}:${String(s).padStart(2, \"0\")}`;\n  };\n\n  const handleSubmit = (isForced = false) => {\n    if (!isForced && Object.keys(answers).length !== quiz.questions.length) {\n      alert(\"Please answer all questions before submitting!\");\n      return;\n    }\n  \n    let score = 0;\n  \n    quiz.questions.forEach((q, i) => {\n      const correct = [...q.answerIndexes].sort();\n      const selected = [...(answers[i] || [])].sort();\n  \n      const match =\n        correct.length === selected.length &&\n        correct.every((val, idx) => val === selected[idx]);\n  \n      if (match) score++;\n    });\n  \n    setScoreCount(score);\n    setSubmitted(true);\n  };  \n\n  if (!quiz) return <div>Quiz not found</div>;\n\n  return (\n    <div>\n      <h1 className=\"quizPageTitleText\">{quiz.quizTitle}</h1>\n\n      {submitted && (\n        <h2 className=\"score\">\n          Score: {scoreCount}/{quiz.questions.length}\n        </h2>\n      )}\n\n      {!hideTimer && (\n        <div className=\"quizPageTextSecondary\">\n          Time Remaining: {formatTime(totalSeconds)}\n        </div>\n      )}\n\n      <ul>\n        {quiz.questions?.map((q, i) => {\n          const selected = answers[i] || [];\n\n          return (\n            <li key={i} style={{ marginBottom: \"20px\" }}>\n              <p className=\"quizPageQuestionText\">{i + 1}. {q.question}</p>\n             \n                {q.questionType === \"Dropdown\" && (\n                   <div className=\"quizPageOptions\">\n                  <select\n                    onChange={(e) => handleSingleSelect(i, Number(e.target.value))}\n                    className=\"input-quiz-option-main\"\n                    value={answers[i]?.[0] ?? \"\"}\n                  >\n                    <option value=\"\" disabled>Select an answer</option>\n                      {q.options.map((opt, idx) => (\n                        <option key={idx} value={idx}>\n                          {opt}\n                        </option>\n                      ))}\n                  </select>\n                  {submitted && (\n                  <div>\n                    Correct Answer: {q.options[q.answerIndexes[0]]}\n                  </div>\n                )}\n                  </div>\n\n                )}\n                \n              \n              {q.questionType !== \"Dropdown\" && ( \n                <ul className=\"quizPageOptions\">\n                  {q.options.map((opt, optIndex) => {\n                    const isSelected = selected.includes(optIndex);\n                    const isCorrect = submitted && q.answerIndexes.includes(optIndex);\n                    const isWrong = submitted && isSelected && !isCorrect;\n\n                    const handleClick =\n                      q.questionType === \"Multiple Answer\"\n                        ? () => handleMultipleToggle(i, optIndex)\n                        : () => handleSingleSelect(i, optIndex);\n\n                    return (\n                      <li\n                        key={optIndex}\n                        onClick={handleClick}\n                        style={{\n                          cursor: submitted ? \"default\" : \"pointer\",\n                          fontWeight: isSelected ? \"bold\" : \"normal\",\n                          color: isCorrect ? \"green\" : isWrong ? \"red\" : \"white\",\n                          display: \"flex\",\n                          alignItems: \"center\"\n                        }}\n                      >\n                        {q.questionType === \"Multiple Answer\" && (\n                          <input\n                            type=\"checkbox\"\n                            checked={isSelected}\n                            readOnly\n                            style={{ marginRight: \"8px\" }}\n                          />\n                        )}\n\n                        {opt}\n                      </li>\n                    );\n                  })}\n                </ul>\n              )}\n\n              {submitted && (\n                <p className=\"quizPageQuestionText\">\n                  Explanation: {q.explanation}\n                </p>\n              )}\n            </li>\n          );\n        })}\n      </ul>\n      {!submitted && <button className=\"submitQuizButton\" onClick={handleSubmit}>Submit Quiz</button>}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAIe,SAAS;IACtB,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,UAAU,aAAa,GAAG,CAAC;IACjC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC,CAAC;IACxC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,UAAU,IAAA,+MAAM,EAAC;IACvB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;QAEd,MAAM,YAAY;YAChB,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM,CAAC,iBAAiB,EAAE,SAAS;gBACrD,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,QAAQ;gBAER,IAAI,KAAK,YAAY,GAAG,GAAG;oBACzB,gBAAgB,KAAK,YAAY;gBACnC,OACK;oBACH,aAAa;gBACf;YAEF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,wBAAwB;YACxC;QACF;QAEA;IACF,GAAG;QAAC;KAAQ;IAEZ,IAAA,kNAAS,EAAC;QACR,IAAI,gBAAgB,KAAK,WAAW;YAClC,cAAc,QAAQ,OAAO;YAC7B;QACF;QAEA,QAAQ,OAAO,GAAG,YAAY;YAC5B,gBAAgB,CAAA;gBACd,IAAI,QAAQ,GAAG;oBACb,cAAc,QAAQ,OAAO;oBAC7B,gBAAgB;oBAChB,aAAa;oBACb,OAAO;gBACT;gBACA,OAAO,OAAO;YAChB;QACF,GAAG;QAEH,OAAO,IAAM,cAAc,QAAQ,OAAO;IAC5C,GAAG;QAAC;QAAc;KAAU;IAE5B,MAAM,qBAAqB,CAAC,eAAe;QACzC,IAAI,WAAW;QACf,WAAW,CAAC,OAAS,CAAC;gBACpB,GAAG,IAAI;gBACP,CAAC,cAAc,EAAE;oBAAC;iBAAY;YAChC,CAAC;IACH;IAEA,MAAM,uBAAuB,CAAC,eAAe;QAC3C,IAAI,WAAW;QAEf,WAAW,CAAC;YACV,MAAM,UAAU,IAAI,CAAC,cAAc,IAAI,EAAE;YACzC,OAAO,QAAQ,QAAQ,CAAC,eACpB;gBAAE,GAAG,IAAI;gBAAE,CAAC,cAAc,EAAE,QAAQ,MAAM,CAAC,CAAC,IAAM,MAAM;YAAa,IACrE;gBAAE,GAAG,IAAI;gBAAE,CAAC,cAAc,EAAE;uBAAI;oBAAS;iBAAY;YAAC;QAC5D;IACF;IAEA,MAAM,aAAa;QACjB,IAAI,QAAQ,OAAO,EAAE;QAErB,MAAM,QAAQ;QACd,IAAI,SAAS,GAAG;QAEhB,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAEhB,QAAQ,OAAO,GAAG,YAAY;YAC5B,gBAAgB,CAAA;gBACd,IAAI,QAAQ,GAAG;oBACb,cAAc,QAAQ,OAAO;oBAC7B,QAAQ,OAAO,GAAG;oBAClB,gBAAgB;oBAChB,aAAa;oBACb,OAAO;gBACT;gBACA,OAAO,OAAO;YAChB;QACF,GAAG;IACL;IAEA,MAAM,YAAY;QAChB,cAAc,QAAQ,OAAO;QAC7B,QAAQ,OAAO,GAAG;IACpB;IAEA,MAAM,aAAa;QACjB;QACA,gBAAgB;QAChB,aAAa;QACb,gBAAgB;QAChB,SAAS;QACT,WAAW;QACX,WAAW;IACb;IAEA,MAAM,aAAa,CAAC;QAClB,MAAM,IAAI,KAAK,KAAK,CAAC,OAAO;QAC5B,MAAM,IAAI,KAAK,KAAK,CAAC,AAAC,OAAO,OAAQ;QACrC,MAAM,IAAI,OAAO;QAEjB,OAAO,GAAG,OAAO,GAAG,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,OAAO,GAAG,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,OAAO,GAAG,QAAQ,CAAC,GAAG,MAAM;IACpG;IAEA,MAAM,eAAe,CAAC,WAAW,KAAK;QACpC,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,SAAS,MAAM,KAAK,KAAK,SAAS,CAAC,MAAM,EAAE;YACtE,MAAM;YACN;QACF;QAEA,IAAI,QAAQ;QAEZ,KAAK,SAAS,CAAC,OAAO,CAAC,CAAC,GAAG;YACzB,MAAM,UAAU;mBAAI,EAAE,aAAa;aAAC,CAAC,IAAI;YACzC,MAAM,WAAW;mBAAK,OAAO,CAAC,EAAE,IAAI,EAAE;aAAE,CAAC,IAAI;YAE7C,MAAM,QACJ,QAAQ,MAAM,KAAK,SAAS,MAAM,IAClC,QAAQ,KAAK,CAAC,CAAC,KAAK,MAAQ,QAAQ,QAAQ,CAAC,IAAI;YAEnD,IAAI,OAAO;QACb;QAEA,cAAc;QACd,aAAa;IACf;IAEA,IAAI,CAAC,MAAM,qBAAO,8OAAC;kBAAI;;;;;;IAEvB,qBACE,8OAAC;;0BACC,8OAAC;gBAAG,WAAU;0BAAqB,KAAK,SAAS;;;;;;YAEhD,2BACC,8OAAC;gBAAG,WAAU;;oBAAQ;oBACZ;oBAAW;oBAAE,KAAK,SAAS,CAAC,MAAM;;;;;;;YAI7C,CAAC,2BACA,8OAAC;gBAAI,WAAU;;oBAAwB;oBACpB,WAAW;;;;;;;0BAIhC,8OAAC;0BACE,KAAK,SAAS,EAAE,IAAI,CAAC,GAAG;oBACvB,MAAM,WAAW,OAAO,CAAC,EAAE,IAAI,EAAE;oBAEjC,qBACE,8OAAC;wBAAW,OAAO;4BAAE,cAAc;wBAAO;;0CACxC,8OAAC;gCAAE,WAAU;;oCAAwB,IAAI;oCAAE;oCAAG,EAAE,QAAQ;;;;;;;4BAErD,EAAE,YAAY,KAAK,4BACjB,8OAAC;gCAAI,WAAU;;kDAChB,8OAAC;wCACC,UAAU,CAAC,IAAM,mBAAmB,GAAG,OAAO,EAAE,MAAM,CAAC,KAAK;wCAC5D,WAAU;wCACV,OAAO,OAAO,CAAC,EAAE,EAAE,CAAC,EAAE,IAAI;;0DAE1B,8OAAC;gDAAO,OAAM;gDAAG,QAAQ;0DAAC;;;;;;4CACvB,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,oBACnB,8OAAC;oDAAiB,OAAO;8DACtB;mDADU;;;;;;;;;;;oCAKlB,2BACD,8OAAC;;4CAAI;4CACc,EAAE,OAAO,CAAC,EAAE,aAAa,CAAC,EAAE,CAAC;;;;;;;;;;;;;4BAQnD,EAAE,YAAY,KAAK,4BAClB,8OAAC;gCAAG,WAAU;0CACX,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK;oCACnB,MAAM,aAAa,SAAS,QAAQ,CAAC;oCACrC,MAAM,YAAY,aAAa,EAAE,aAAa,CAAC,QAAQ,CAAC;oCACxD,MAAM,UAAU,aAAa,cAAc,CAAC;oCAE5C,MAAM,cACJ,EAAE,YAAY,KAAK,oBACf,IAAM,qBAAqB,GAAG,YAC9B,IAAM,mBAAmB,GAAG;oCAElC,qBACE,8OAAC;wCAEC,SAAS;wCACT,OAAO;4CACL,QAAQ,YAAY,YAAY;4CAChC,YAAY,aAAa,SAAS;4CAClC,OAAO,YAAY,UAAU,UAAU,QAAQ;4CAC/C,SAAS;4CACT,YAAY;wCACd;;4CAEC,EAAE,YAAY,KAAK,mCAClB,8OAAC;gDACC,MAAK;gDACL,SAAS;gDACT,QAAQ;gDACR,OAAO;oDAAE,aAAa;gDAAM;;;;;;4CAI/B;;uCAnBI;;;;;gCAsBX;;;;;;4BAIH,2BACC,8OAAC;gCAAE,WAAU;;oCAAuB;oCACpB,EAAE,WAAW;;;;;;;;uBArExB;;;;;gBA0Eb;;;;;;YAED,CAAC,2BAAa,8OAAC;gBAAO,WAAU;gBAAmB,SAAS;0BAAc;;;;;;;;;;;;AAGjF","debugId":null}}]
}