{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/admin/Downloads/study-space-ai/client/study-space/app/api/youtube-route/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { YoutubeTranscript } from \"youtube-transcript-plus\";\n\nfunction extractVideoId(url) {\n  if (!url) return null;\n\n  const patterns = [\n    /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/)([^&\\n?#]+)/,\n    /^([a-zA-Z0-9_-]{11})$/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match?.[1]) return match[1];\n  }\n\n  return null;\n}\n\nfunction formatError(message, status = 400) {\n  return NextResponse.json({ error: message }, { status });\n}\n\nexport async function POST(req) {\n  try {\n    const { url } = await req.json();\n    if (!url) return formatError(\"YouTube URL is required\");\n\n    const videoId = extractVideoId(url);\n    if (!videoId) return formatError(\"Please provide a valid YouTube video URL\");\n\n    if (!videoId) {\n      return NextResponse.json(\n        { error: \"Invalid YouTube URL. Please provide a valid YouTube video URL.\" },\n        { status: 400 }\n      );\n    }\n\n    // Fetch transcript from YouTube (prefer English, fallback to available language)\n    let transcriptData;\n    try {\n      transcriptData = await YoutubeTranscript.fetchTranscript(videoId, {\n        lang: \"en\",\n      });\n    } catch {\n      transcriptData = await YoutubeTranscript.fetchTranscript(videoId);\n    }\n\n    if (!Array.isArray(transcriptData) || transcriptData.length === 0) {\n      return formatError(\n        \"Transcript is unavailable for this video. Please try one with captions enabled.\",\n        404\n      );\n    }\n\n    const transcriptText = transcriptData\n      .map((item) =>\n        typeof item === \"object\"\n          ? item.text || item.transcript || item.content || \"\"\n          : String(item || \"\")\n      )\n      .filter((chunk) => chunk.trim().length > 0)\n      .join(\" \")\n      .trim();\n\n    if (!transcriptText) {\n      return formatError(\n        \"Transcript is empty. Please try a different video with captions enabled.\",\n        404\n      );\n    }\n\n    return NextResponse.json({ text: transcriptText });\n  } catch (error) {\n    if (error.message?.includes(\"Transcript is disabled\")) {\n      return formatError(\n        \"Transcript is not available for this video. The video owner may have disabled captions.\",\n        404\n      );\n    }\n\n    if (\n      error.message?.includes(\"Could not retrieve a transcript\") ||\n      error.message?.includes(\"No transcripts were found\")\n    ) {\n      return formatError(\n        \"No transcript available for this video. Please try a different video with captions enabled.\",\n        404\n      );\n    }\n\n    return formatError(\n      \"Failed to fetch transcript. Please ensure the video has captions enabled.\",\n      500\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;;;;;;;;AAGA,SAAS,eAAe,GAAG;IACzB,IAAI,CAAC,KAAK,OAAO;IAEjB,MAAM,WAAW;QACf;QACA;KACD;IAED,KAAK,MAAM,WAAW,SAAU;QAC9B,MAAM,QAAQ,IAAI,KAAK,CAAC;QACxB,IAAI,OAAO,CAAC,EAAE,EAAE,OAAO,KAAK,CAAC,EAAE;IACjC;IAEA,OAAO;AACT;AAEA,SAAS,YAAY,OAAO,EAAE,SAAS,GAAG;IACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;QAC9B,IAAI,CAAC,KAAK,OAAO,YAAY;QAE7B,MAAM,UAAU,eAAe;QAC/B,IAAI,CAAC,SAAS,OAAO,YAAY;QAEjC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiE,GAC1E;gBAAE,QAAQ;YAAI;QAElB;QAEA,iFAAiF;QACjF,IAAI;QACJ,IAAI;YACF,iBAAiB,MAAM,kBAAkB,eAAe,CAAC,SAAS;gBAChE,MAAM;YACR;QACF,EAAE,OAAM;YACN,iBAAiB,MAAM,kBAAkB,eAAe,CAAC;QAC3D;QAEA,IAAI,CAAC,MAAM,OAAO,CAAC,mBAAmB,eAAe,MAAM,KAAK,GAAG;YACjE,OAAO,YACL,mFACA;QAEJ;QAEA,MAAM,iBAAiB,eACpB,GAAG,CAAC,CAAC,OACJ,OAAO,SAAS,WACZ,KAAK,IAAI,IAAI,KAAK,UAAU,IAAI,KAAK,OAAO,IAAI,KAChD,OAAO,QAAQ,KAEpB,MAAM,CAAC,CAAC,QAAU,MAAM,IAAI,GAAG,MAAM,GAAG,GACxC,IAAI,CAAC,KACL,IAAI;QAEP,IAAI,CAAC,gBAAgB;YACnB,OAAO,YACL,4EACA;QAEJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAe;IAClD,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,OAAO,EAAE,SAAS,2BAA2B;YACrD,OAAO,YACL,2FACA;QAEJ;QAEA,IACE,MAAM,OAAO,EAAE,SAAS,sCACxB,MAAM,OAAO,EAAE,SAAS,8BACxB;YACA,OAAO,YACL,+FACA;QAEJ;QAEA,OAAO,YACL,6EACA;IAEJ;AACF","debugId":null}}]
}